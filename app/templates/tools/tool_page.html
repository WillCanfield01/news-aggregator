{% extends "base.html" %}

{% block title %}{{ tool.title }} – Tools{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='tools/tools.css') }}">
<script src="{{ url_for('static', filename='tools/tools.js') }}" defer></script>
{% endblock %}

{% block content %}
<section class="tools-shell">
    <nav class="tool-breadcrumb" aria-label="Breadcrumb">
        <a href="{{ url_for('tools.tools_home') }}">Tools</a>
        <span aria-hidden="true">/</span>
        <span class="crumb-current">{{ tool.title }}</span>
    </nav>

    {% if tool.slug == "daily-checkin" %}
    <div class="tool-note" role="note">
        Data for this habit stays in your browser’s storage only. Clear site data to remove it—no account required.
    </div>
    {% endif %}

    {% if error_message %}
    <div class="tool-note" role="alert">
        {{ error_message }}
    </div>
    {% endif %}

    <div class="tool-detail">
        <header class="tool-header">
            <p class="eyebrow">{{ tool.category }}</p>
            <h1>{{ tool.title }}</h1>
            <p class="lead">{{ tool.description }}</p>
            {% if callout_message %}
            <div class="tool-note" role="note">{{ callout_message }}</div>
            {% endif %}
        </header>

        <div class="tool-panel" aria-live="polite">
            <form class="tool-form" data-tool-form data-tool-slug="{{ tool.slug }}"
                data-output-label="{{ tool.output_label }}" aria-label="{{ tool.title }} input form"
                data-view-mode="{{ 'true' if view_mode else 'false' }}"
                {% if saved_input %}data-saved-input='{{ saved_input|safe }}'{% endif %}
                {% if share_url %}data-share-initial="{{ share_url }}"{% endif %}>
                {% for field in tool.inputs %}
                <div class="tool-field">
                    <label for="field-{{ field.name }}">{{ field.label }}{% if field.required %}*{% endif %}</label>
                    {% if field.type == "textarea" %}
                    <textarea id="field-{{ field.name }}" name="{{ field.name }}" rows="4" placeholder="{{ field.placeholder }}"
                        {% if field.required %}required{% endif %} maxlength="{{ field.max_chars }}"
                        data-input-field data-type="{{ field.type }}"></textarea>
                    {% elif field.type == "select" %}
                    <select id="field-{{ field.name }}" name="{{ field.name }}" data-input-field data-type="{{ field.type }}"
                        {% if field.required %}required{% endif %}>
                        {% if not field.required %}<option value="">Select an option</option>{% endif %}
                        {% for option in field.options %}
                        <option value="{{ option }}" {% if field.default and field.default == option %}selected{% endif %}>{{ option }}</option>
                        {% endfor %}
                    </select>
                    {% else %}
                    <input id="field-{{ field.name }}" type="text" name="{{ field.name }}" placeholder="{{ field.placeholder }}"
                        {% if field.required %}required{% endif %} maxlength="{{ field.max_chars }}"
                        data-input-field data-type="{{ field.type }}">
                    {% endif %}
                    {% if field.max_chars %}<small class="char-limit">Max {{ field.max_chars }} chars</small>{% endif %}
                </div>
                {% endfor %}
                <div id="tool-custom-ui"></div>
                <div class="tool-actions">
                    <button type="submit" class="tool-run-btn" data-run-button>Run tool</button>
                    <button type="button" class="tool-clear-btn" data-clear-button style="display:none;">Clear habit data</button>
                    <button type="button" class="tool-copy-btn" data-copy-button style="display:none;">Copy to new</button>
                </div>
            </form>
            <div class="tool-status" data-tool-status role="status" aria-live="polite"></div>
            <div class="tool-output" data-tool-output>
                <div class="tool-output-label">{{ tool.output_label }}</div>
                <pre class="tool-output-pre" aria-live="polite">{% if saved_output %}{{ saved_output }}{% endif %}</pre>
                <div class="tool-share" data-share-block style="display:none;">
                    <div class="tool-share-link">
                        <span data-share-url></span>
                        <button type="button" data-copy-share class="tool-copy-share">Copy link</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}
